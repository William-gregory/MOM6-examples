01. cd /lustre/f2/dev/$USER/
02. git clone --recursive https://github.com/William-gregory/MOM6-examples.git MOM6-examples
03. cd MOM6-examples
04. git branch forpy_dev
05. git switch forpy_dev
04. mkdir build
05. mkdir -p build/fms/
06. mkdir -p build/ice_ocean_SIS2
07. cp /autofs/ncrc-svm1_home1/Yongfei.Zhang/fre/FMS2023.01_mom6_20230630/MOM6_SIS2_compile/src/mom6/src/SIS2/src/SIS_get_input.F90 src/SIS2/src/SIS_get_input.F90 #allow model to run in ensemble mode

### COMPILE FMS ###
08. cd build/fms
09. rm -f path_names
10. ../../src/mkmf/bin/list_paths -l ../../src/FMS
11. ../../src/mkmf/bin/mkmf -t ../../src/mkmf/templates/ncrc5-intel-classic.mk -p libfms.a -c "-Duse_libMPI -Duse_netCDF" path_names
12. make NETCDF=3 REPRO=1 libfms.a -j

### COMPILE MOM6/SIS2 ###
13. cd ../ice_ocean_SIS2
14. rm -f path_names
15. ../../src/mkmf/bin/list_paths -l ./ ../../src/MOM6/config_src/{infra/FMS1,memory/dynamic_symmetric,drivers/FMS_cap,external} ../../src/SIS2/config_src/dynamic_symmetric ../../src/MOM6/src/{*,*/*}/ ../../src/{atmos_null,coupler,land_null,ice_param,icebergs/src,SIS2,FMS/coupler,FMS/include}/
16. ../../src/mkmf/bin/mkmf -t ../../src/mkmf/templates/ncrc5-intel-classic.mk -o '-I../fms -I/opt/cray/pe/netcdf/default/intel/19.0/include -I/opt/cray/pe/hdf5/default/intel/19.0/include' -p MOM6 -l '-L../fms -lfms -L/opt/cray/pe/netcdf/default/intel/19.0/lib -lnetcdff -lnetcdf -L/opt/cray/pe/hdf5/default/intel/19.0/lib -lhdf5 `python3-config --ldflags --embed`' -c '-Duse_AM3_physics -D_USE_LEGACY_LAND_' path_names
17. make REPRO=1 MOM6 -j

### LINK DATA SETS ###
18. cd ../../ice_ocean_SIS2/OM4_025.JRA/INPUT
19. ln -sf /autofs/ncrc-svm1_home1/Alistair.Adcroft/fre/FMS2023.01_mom6_20230630/MOM6_SIS2_compile/src/mom6/ice_ocean_SIS2/OM4_025.JRA/INPUT/woa13_decav_s_monthly_fulldepth_01.nc woa13_decav_s_monthly_fulldepth_01.nc
20. ln -sf /autofs/ncrc-svm1_home1/Alistair.Adcroft/fre/FMS2023.01_mom6_20230630/MOM6_SIS2_compile/src/mom6/ice_ocean_SIS2/OM4_025.JRA/INPUT/woa13_decav_ptemp_monthly_fulldepth_01.nc woa13_decav_ptemp_monthly_fulldepth_01.nc
